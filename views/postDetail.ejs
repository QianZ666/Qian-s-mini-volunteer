<%- include('header') %> 
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="post-content shadow-sm p-4 bg-white rounded">

        <!-- 封面图片 -->
        <% if (post.photoPath) { %>
          <img src="<%= post.photoPath %>" alt="post-image" class="img-fluid w-50 rounded mb-3">
        <% } else { %>
          <img src="https://www.bootdey.com/image/400x150/FFB6C1/000000" alt="default-image" class="img-fluid rounded mb-3">
        <% } %>
        

        <div class="post-container">
          <!-- 发帖人头像 -->
          <img src="https://bootdey.com/img/Content/avatar/avatar6.png" alt="user" class="profile-photo-md float-start me-3">

          <div class="post-detail">
            <div class="user-info mb-2">
              <h5 class="mb-1">Help Request: <%= post.title %></h5>
              <p class="text-muted">Posted on <%= post.createdAt.toLocaleString() %></p>
            </div>

            <!-- 帖子内容 -->
            <div class="post-text mb-3">
              <p><strong>📍 Location:</strong> <%= post.location %></p>
              <p><strong>📅 Date:</strong> <%= post.date %> <strong>🕐 Time:</strong> <%= post.time %></p>
              <p><strong>⚠️ Urgency:</strong> <%= post.urgency %></p>
              <p><strong>📞 Contact:</strong> <%= post.contact %></p>
              <hr>
              <p><%= post.description %></p>

            <% if (isOwner) { %>
              <!-- This is your own post -->
              <p class="text-muted">📝 This is a task you created.</p>

              <% if (!post.volunteer) { %>
                <p>Waiting for a volunteer to accept this task...</p>
              <% } else { %>
                <p>Volunteer: <%= post.volunteer.name %> (Status: <%= post.volunteer.status %>)</p>
              <% } %>

            <% } else if (!post.volunteer|| !post.volunteer.userId) { %>
              <!-- Task has not been accepted yet -->
              <button id="acceptBtn" class="btn btn-primary">Accept</button>

              <div id="volunteerForm" style="display:none;" class="mt-3">
                <form id="acceptForm" data-postid="<%= post._id %>">
                  <input type="text" name="name" placeholder="Your Name" class="form-control mb-2" required>
                  <input type="text" name="phone" placeholder="Your Phone Number" class="form-control mb-2" required>
                  <button type="submit" class="btn btn-success">Submit</button>
                </form>
              </div>

            <% } else if (
                    post.volunteer &&
                    post.volunteer.userId &&
                    user &&
                    user._id &&
                    post.volunteer.userId.toString() === user._id.toString() &&
                    post.volunteer.status === 'holding'
              ) { %>
              <!-- Current user is the volunteer and task is not yet completed -->
              <form action="/completeTask/<%= post._id %>" method="POST">
                <button type="submit" class="btn btn-success">Mark as Completed</button>
              </form>

            <% } else { %>
              <!-- Task already accepted by another volunteer -->
              <p class="text-muted">✅ This task has already been accepted.</p>
            <% } %>


            <!-- 评论部分（你未来可以加评论系统） -->
            <div class="line-divider"></div>
            <div class="post-comment d-flex align-items-center mt-3">
              <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="profile-photo-sm me-2">
              <input type="text" class="form-control" placeholder="Leave a comment">
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</div>
<script src="/js/postDetail.js"></script>
<%- include('footer') %> 